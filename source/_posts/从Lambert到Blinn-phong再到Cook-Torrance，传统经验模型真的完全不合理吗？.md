---
title: 从Cook-Torrance看Lambert到Blinn-phong，传统经验模型真的完全不合理吗？
date: 2023-10-25 18:18:50
tags:
- CG
categorys:
- 计算机图形学
---
## 动机

最近出于各种原因，我在看一些经典的光照模型：Lambert、Phong还有Blinn-Phong。当然，经典的PBR渲染公式也不能忘记。什么微表面理论，菲涅尔项之类的。说到微表面模型，就不能忘记GGX。在GGX中有一个关键的计算，就是需要取一下视线向量和光线向量的加和，然后再取这个加和得到的向量与平面法线向量的夹角。很巧合的是，Blinn Phong模型作为一个经验模型也采用了一个类似的运算。那么这里有什么关系呢？我自己尝试使用微表面理论进行解释，一点问题都没有。我就在想，用一个所谓未来理论的假说解释一个过去古老的经验模型，是否有些不妥。我便拿来了原来提出Blinn Phong模型的论文，才发现倒错的是我。Cook-Torrance模型早于Blinn Phong模型，并且Blinn Phong模型的合理性就是由Cook-Torrance模型进行解释。这种反差让我感受到了一种时代的错位感，就像是你发现并不是先有谭浩强后有C++一样离谱。但是有没有可能只是我们忘记了历史，忘记了计算机图形学的发展脉络呢？我认为，**伟人们早在他们的时代便提出了超前的构思，而又陷于时代只能假设一些经验前提来简化计算，进而有了当时所谓的经验模型。** 因此我便想通过这篇文章，从历史的角度，揣度或重现过去学者对于光照模型的构思，并从此窥见光照模型发展的脉络。

## 研究的入手点与方法

本篇文章主要集中于Lambert、Phong以及Blinn-Phong三个经典经验模型，涉及到微表面理论，以及部分辐射度量学。Blinn-Phong的原论文非常精彩，甚至十分超前。在本篇文章内，我们从1986年的渲染方程理论入手，结合辐射度量学，对比当时他们提出的理论与后来渲染方程之间的关系，探究这三个模型做出的经验性假设。

## 相关工作

### 微表面模型

### 简单能量守恒

对于受到辐射的物体，辐射本身的能量被分为了两部分。一部分被物体吸收，然后通过光线在物体中的碰撞再以某种形式散发出来，这种形式可能是光能或者热能。还有部分的能量被物体表面反射，进入到我们的人眼中。对于这两个不同的能量部分，我们将反射到我们眼中的光称为Specular，也就是镜面反射光。经过物体内部折射然后从物体内部发出的光称为Diffuse，也就是漫反射光。

### 渲染方程

渲染方程如下所示：

$$
L_o(x,\omega_o,\lambda)=L_e(x,\omega_o,\lambda)+L_r(x,\omega_o,\lambda)\\
L_r(x,\omega_o,\lambda) = \int_\Omega f_r(x,\omega_i,\omega_o,\lambda)L_i(x,\omega_i,\lambda)(\omega_i ·n) \mathrm{d}\omega_i
$$

在其中，几个符号这么解释：

* $x$为被光照射或者被观察到的点；
* $\lambda$为光的波长；
* $\omega_o$为观察者眼睛到被观察点的向量；$\omega_i$为入射光打在被观察点的向量。

方程整体上这个又分成了两个部分：

* $L_e$和$L_r$。$L_e$对应着能量守恒理论中的漫反射以及物体自发光的部分；
* $L_r$则对应着能量守恒中的镜面反射部分。

在$L_r$的部分，又有三个大块：

* $f_r$代表着一个物体的BRDF，也就是双向反射分布函数。他代表着通过镜面反射从$\omega_o$方向射出的光线相对于从$\omega_i$方向射向点$x$的，波长为$\lambda$的光线所含能量的倍数。
* $L_i$则代表着从$\omega_i$射向$x$点的波长为$\lambda$的光线所含能量大小。
* 最后$(\omega_i ·n)$为Lambert系数项。因为光线与观察面优势并不是垂直的，观察面所接受的irradiance需要通过光线与法线的夹角的余弦值来进行修正。

### Cook-Torrance模型

Torrance模型通过一个假设理论来描述渲染方程的$f_r$项。其表达大致如下所示：
$$
f_{Cook-Torrance}=\frac{DFG}{4(\omega_o ·n)(\omega_i ·n)}
$$

对于模型来说，主要分成3个部分：

* D：每单位面积,每单位立体角所有法向为$h$的微平面的面积
* F：描述了物体表面在不同入射光角度下反射光线所占的比率
* G：描述了微平面自遮挡的属性。

但下面的参数究竟是怎么来的？这里涉及到一些辐射度量学和数学知识，建议参考[这篇文章](https://zhuanlan.zhihu.com/p/152226698)进行推导。从结果来看，下面的参数是我们针对D项做的一些修正。

## 从现代角度对传统光照模型的分析

### Lambert

Lambert模型算是十分古老的模型，也是最简单的光照模型。Lambert模型发现了一个基本的要素：法线面向光源的面越亮，法线越垂直于光源的面越暗。这个亮度和$cos\theta$相关。

我们从辐射度量学的角度来看这件事。对于一个单位面积上的单位立体角$\mathbf{d}A\mathbf{d}\omega_h$，根据radiance的定义$\frac{\mathbf{d}^2\phi}{cos\theta\mathbf{d}\omega\mathbf{d}A}$得知，当前表面的Irradiance为$L_i  cos\theta$，其中$\theta$为法线与光照方向的夹角。通过辐射度量学，我们解释了了为什么光照不是线性变化的，而是使用$cos\theta$描述。

我们将Lambert模型的表达带回到渲染方程中，可以很轻易地计算出Lambert模型对应的BRDF为$\frac{c}{\pi}$ [^1]，其中c为物体自带的固有色。也就是说Lambert模型基于以下的事实与假设：

[^1]:这里我们为了能量守恒，除以一个$\pi$。

 现象：
>
> * 法线面向光源的面越亮，法线越垂直于光源的面越暗。
>
事实：
>
> * 根据辐射度量学，一个面上接受的能量与光线与表面法线夹角的余弦成正比。
>
假设：
>
> * 从表面上向任意方向反射的光的强度是均匀的。
>  

这十分的有趣。$cos\theta$的出现说明当时的学者已经意识到辐射度量学对于CG的意义，并基于这个理论构建模型。最简单的实现版本是直接使用余弦来计算亮度，而这样会使得物体放出的能量比它接收要多。不过我们同样可以通过辐射度量学，使用一个线性系数$\frac{1}{\pi}$让其变得能量守恒。虽然这个世界上不存在均匀向四周反射光线的物体，但这种假设也依然符合我们对于漫反射物体的认知。

### Phong与Blinn-Phong

Phong与Blinn-Phong是相较于Lambert模型更良好的模型，但在很多资料上并没有证明为什么他们，尤其是Blinn-Phong相较于Lambert更好。 也许是因为这个原因，通常他们被认为是经验上的改进。但其实从Blinn-Phong的原论文来看，Blinn-Phong模型已经运用上了微表面理论与初级的Torrance模型。

## 注释与引用
